<%- include("partials/head", { title: title }) %>
<%- include("partials/header") %>

<div class="zu-substitutions">
  <aside class="sidebar">
    <div class="sidebar-top">
      <h6 class="text-info fw-semibold mb-2"><i class="bi bi-calendar-week"></i> Dni</h6>
      <% dni.forEach(d => { %>
        <a href="/zastepstwa/<%= d %>?tryb=<%= tryb %>"
           class="day <%= dzien === d ? 'active' : '' %>">
          <%= d.charAt(0).toUpperCase() + d.slice(1) %>
        </a>
      <% }) %>
    </div>

    <div class="sidebar-bottom mt-4">
      <h6 class="text-info fw-semibold mb-2"><i class="bi bi-funnel"></i> Filtry</h6>
      <form method="get" action="/zastepstwa/<%= dzien %>">
        <div class="form-check">
          <input class="form-check-input" type="radio" name="tryb" value="class" id="class"
                 <%= tryb === 'class' ? 'checked' : '' %>>
          <label class="form-check-label" for="class"><i class="bi bi-people"></i> Klasa</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="radio" name="tryb" value="teacher" id="teacher"
                 <%= tryb === 'teacher' ? 'checked' : '' %>>
          <label class="form-check-label" for="teacher"><i class="bi bi-person-vcard"></i> Nauczyciel</label>
        </div>

        <button type="submit" class="btn btn-primary btn-sm w-100 mt-3">
          <i class="bi bi-search"></i> Filtruj
        </button>
      </form>
    </div>
  </aside>

  <main>
    <h2 class="section-title"><i class="bi bi-calendar-day"></i>
      <%= dzien.charAt(0).toUpperCase() + dzien.slice(1) %> — Zastępstwa
    </h2>

    <% if (zastepstwa && zastepstwa.length > 0) { %>
      <!-- === Widok pogrupowany (jak logi) === -->
      <% Object.keys(grouped).forEach(key => { %>
        <h5 class="log-day mt-4">
          <%= tryb === 'class' ? 'Klasa: ' : 'Nauczyciel: ' %><%= key %>
        </h5>
        <div class="log-box">
        <% grouped[key].forEach(z => { %>
            <div>[<%= z.godzina %>] <strong><%= z.przedmiot %></strong> 
              — <%= z.klasa %> — <%= z.nauczyciel_nieobecny %> 
              → <span class="text-info"><%= z.nauczyciel_zastepujacy || '—' %></span>
            </div>
          <% }) %>
        </div>
      <% }) %>
    <% } else { %>
      <div class="no-data text-center py-5">
        <i class="bi bi-emoji-sunglasses" style="font-size:3rem;color:#58a6ff;"></i>
        <h3 class="mt-3 text-info">Brak zastępstw</h3>
        <p class="text-secondary">Wszyscy nauczyciele są obecni. Miłego dnia!</p>
      </div>
    <% } %>
  </main>
</div>

<%- include("partials/footer", { active: active }) %>
