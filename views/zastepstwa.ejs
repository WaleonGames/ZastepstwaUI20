<%- include("partials/head", { title: title }) %>
<%- include("partials/header") %>

<div class="zu-substitutions">
  <aside class="sidebar">
    <div class="sidebar-top">
      <h6 class="text-info fw-semibold mb-2"><i class="bi bi-calendar-week"></i> Dni</h6>
      <% dni.forEach(d => { %>
        <a href="/zastepstwa/<%= d %>?tryb=<%= tryb %>"
           class="day <%= dzien === d ? 'active' : '' %>">
          <%= d.charAt(0).toUpperCase() + d.slice(1) %>
        </a>
      <% }) %>
    </div>

    <div class="sidebar-bottom mt-4">
      <h6 class="text-info fw-semibold mb-2"><i class="bi bi-funnel"></i> Filtry</h6>
      <form method="get" action="/zastepstwa/<%= dzien %>">
        <div class="form-check">
          <input class="form-check-input" type="radio" name="tryb" value="class" id="class"
                 <%= tryb === 'class' ? 'checked' : '' %>>
          <label class="form-check-label" for="class"><i class="bi bi-people"></i> Klasa</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="radio" name="tryb" value="teacher" id="teacher"
                 <%= tryb === 'teacher' ? 'checked' : '' %>>
          <label class="form-check-label" for="teacher"><i class="bi bi-person-vcard"></i> Nauczyciel</label>
        </div>

        <button type="submit" class="btn btn-primary btn-sm w-100 mt-3">
          <i class="bi bi-search"></i> Filtruj
        </button>
      </form>
    </div>
  </aside>

  <main>
    <h2 class="section-title"><i class="bi bi-calendar-day"></i>
      <%= dzien.charAt(0).toUpperCase() + dzien.slice(1) %> â€” ZastÄ™pstwa
    </h2>

    <% if (zastepstwa && zastepstwa.length > 0) { %>
      <!-- === Widok pogrupowany (jak logi) === -->
      <% Object.keys(grouped).forEach(key => { %>
        <h5 class="log-day mt-4">
          <%= tryb === 'class' ? 'Klasa: ' : 'Nauczyciel: ' %><%= key %>
        </h5>
        <div class="log-box">
          <% grouped[key].forEach(z => { %>

            <div class="log-entry mb-3">

              <!-- GODZINA -->
              <div class="log-time fw-bold">
                ğŸ•’ <%= z.godzina %>
              </div>

              <!-- PRZEDMIOT + SALA -->
              <div class="log-meta text-secondary mt-1">
                <% if (z.przedmiot) { %>
                  <div>ğŸ“˜ <strong><%= z.przedmiot %></strong></div>
                <% } %>

                <% if (z.sala) { %>
                  <div>ğŸ« Sala: <%= z.sala %></div>
                <% } %>
              </div>

              <!-- NAUCZYCIELE -->
              <div class="log-teachers mt-1">
                ğŸ‘©â€ğŸ« Nieobecny: <strong><%= z.nauczyciel_nieobecny %></strong><br>

                <% if (z.nauczyciel_zastepujacy) { %>
                  ğŸ”„ ZastÄ™puje: <span class="text-info"><%= z.nauczyciel_zastepujacy %></span><br>
                <% } else { %>
                  ğŸ”„ ZastÄ™puje: â€” <br>
                <% } %>
              </div>

              <!-- STATUS -->
              <div class="log-status mt-1">
                <% if (z.status === "Å‚Ä…czenie") { %>
                  <span class="badge bg-primary">
                    <i class="bi bi-link-45deg"></i> ÅÄ…czenie
                  </span>

                  <% if (z.polaczone_z) { %>
                    <div class="text-secondary mt-1">
                      ğŸ”— Klasa Å‚Ä…czona: <strong><%= z.polaczone_z %></strong>
                    </div>
                  <% } %>

                  <div class="text-secondary mt-1">
                    <%= z.opis %>
                  </div>

                <% } else if (z.status === "zastÄ™pstwo") { %>
                  <span class="badge bg-warning text-dark">
                    <i class="bi bi-arrow-repeat"></i> ZastÄ™pstwo
                  </span>

                  <div class="text-secondary mt-1">
                    <%= z.opis %>
                  </div>

                <% } else { %>
                  <span class="badge bg-danger">
                    <i class="bi bi-x-circle"></i> OdwoÅ‚ane
                  </span>

                  <div class="text-secondary mt-1">
                    <%= z.opis %>
                  </div>
                <% } %>
              </div>

            </div>

          <% }) %>
        </div>
      <% }) %>
    <% } else { %>
      <div class="no-data text-center py-5">
        <i class="bi bi-emoji-sunglasses" style="font-size:3rem;color:#58a6ff;"></i>
        <h3 class="mt-3 text-info">Brak zastÄ™pstw</h3>
        <p class="text-secondary">Wszyscy nauczyciele sÄ… obecni. MiÅ‚ego dnia!</p>
      </div>
    <% } %>
  </main>
</div>

<%- include("partials/footer", { active: active }) %>
