<footer class="footer-nav border-top shadow-lg footer-<%= footerMode %>">
  <div class="footer-container">

    <div class="footer-left">
      <a href="/" class="dock-icon <%= active === 'home' ? 'active' : '' %>">
        <i class="bi bi-house"></i>
        <% if (footerMode === 'icons-text') { %><span>Start</span><% } %>
      </a>

      <a href="/zastepstwa" class="dock-icon <%= active === 'zastepstwa' ? 'active' : '' %>">
        <i class="bi bi-calendar-week"></i>
        <% if (footerMode === 'icons-text') { %><span>Zastępstwa</span><% } %>
      </a>

      <a href="/klasy" class="dock-icon <%= active === 'klasy' ? 'active' : '' %>">
        <i class="bi bi-people"></i>
        <% if (footerMode === 'icons-text') { %><span>Klasy</span><% } %>
      </a>

      <a href="/nauczyciele" class="dock-icon <%= active === 'nauczyciele' ? 'active' : '' %>">
        <i class="bi bi-person-video2"></i>
        <% if (footerMode === 'icons-text') { %><span>Nauczyciele</span><% } %>
      </a>

      <a href="/ustawienia" class="dock-icon <%= active === 'ustawienia' ? 'active' : '' %>">
        <i class="bi bi-gear"></i>
        <% if (footerMode === 'icons-text') { %><span>Ustawienia</span><% } %>
      </a>
    </div>


    <!-- ◆◆◆ DATA / GODZINA ◆◆◆ -->
    <div class="footer-right <%= dateFormat === 'vertical' ? 'date-vertical' : 'date-horizontal' %>" id="openCalendar">
      <div id="footer-time" class="time"></div>

      <% if (dateFormat === 'horizontal') { %>
        <span class="separator">|</span>
      <% } else { %>
        <span class="separator-vertical"></span>
      <% } %>

      <div id="footer-date" class="date"></div>
    </div>

  </div>
</footer>

<%
const now = calendar.now;
const year = calendar.year;
const month = calendar.month;
const day = calendar.day;
const weekday = calendar.weekday;

const monthsPL = calendar.monthsPL;
const daysPL = calendar.daysPL;

// Obliczenia rozpoczynają pierwszą kolumnę jako PONIEDZIAŁEK
const firstDay = new Date(year, month, 1);
let startWeekDay = firstDay.getDay();
if (startWeekDay === 0) startWeekDay = 7; // niedziela → kolumna 7

const monthDays = new Date(year, month + 1, 0).getDate();
const adjustedStart = startWeekDay; // np. poniedziałek = 1

// Zbieramy dni wolne z calendar.json
const freeDays = [];
if (schoolCalendar?.swieta) {
  for (const [nazwa, wartosc] of Object.entries(schoolCalendar.swieta)) {
    if (typeof wartosc === "string") {
      freeDays.push(wartosc);
    } else if (Array.isArray(wartosc)) {
      let d = new Date(wartosc[0]);
      let end = new Date(wartosc[1]);
      while (d <= end) {
        freeDays.push(d.toISOString().slice(0,10));
        d = new Date(d.getTime() + 86400000);
      }
    }
  }
}
%>

<div class="calendar-embed" id="calendarEmbed">

  <div class="cal-top">
    <div class="cal-dayname"><%= daysPL[weekday] %></div>
    <div class="cal-full-date"><%= day %> <%= monthsPL[month] %> <%= year %></div>
  </div>

  <div class="cal-month-header">
    <span><%= monthsPL[month] %> <%= year %></span>
  </div>

  <div class="cal-grid cal-weekdays">
    <div>P</div><div>W</div><div>Ś</div><div>C</div><div>P</div>
    <div class="weekend">S</div>
    <div class="weekend">N</div>
  </div>

  <div class="cal-grid">
    <% for (let i = 1; i < adjustedStart; i++) { %>
      <div class="empty"></div>
    <% } %>

    <% for (let d = 1; d <= monthDays; d++) {
         const dateISO = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
         const dayDate = new Date(dateISO);
         const wd = dayDate.getDay();
         const isWeekend = (wd === 0 || wd === 6);
         const isToday = d === day;
         const isFree = freeDays.includes(dateISO);

         const tooltip = `${daysPL[wd]} — ${d} ${monthsPL[month]} ${year}`;
    %>

      <div 
        class="cal-day 
         <%= isToday ? 'today' : '' %> 
         <%= isWeekend ? 'weekend-day' : '' %> 
         <%= isFree ? 'free-day' : '' %>"
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="<%= tooltip %>"
      >
        <%= d %>
      </div>

    <% } %>
  </div>

  <div class="cal-legend mt-3">
    <div><span class="box weekend-box"></span> Weekend</div>
    <div><span class="box today-box"></span> Dziś</div>
    <div><span class="box free-box"></span> Dzień wolny (kalendarz szkolny)</div>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="/script.js"></script>
