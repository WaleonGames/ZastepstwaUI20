<header class="navbar border-bottom border-secondary shadow-sm py-2 px-3 topbar">
  <div class="container-fluid d-flex justify-content-between align-items-center">    
    <!-- TytuÅ‚ -->
    <div class="topbar-title d-flex align-items-center gap-2">
      <i class="bi bi-mortarboard text-info fs-4"></i>
      <span class="fw-semibold text-info fs-5">Panel Publicznego Ucznia</span>
    </div>
  </div>
</header>

<!-- ðŸ”” ALERT â€“ OgÅ‚oszenie nagÅ‚e -->
<div id="urgent-alert" 
     class="alert alert-warning alert-dismissible fade show visually-hidden"
     role="alert">

  <div class="urgent-alert-scroll">
    <i class="bi bi-exclamation-triangle-fill fs-4 me-2"></i>
    <span id="urgent-alert-text"></span>
    <span id="urgent-alert-timer" class="fw-bold"></span>
  </div>

  <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
</div>

<script>
let urgentInterval = null;

function showUrgentAlert(text, seconds = 60) {
    const alertBox = document.getElementById("urgent-alert");
    const alertText = document.getElementById("urgent-alert-text");
    const timerLabel = document.getElementById("urgent-alert-timer");

    alertText.textContent = text + " ";
    timerLabel.textContent = "";

    // pokaÅ¼ alert
    alertBox.classList.remove("visually-hidden");

    // czas wygaÅ›niÄ™cia
    const expireTime = Date.now() + seconds * 1000;
    localStorage.setItem("urgent_alert_text", text);
    localStorage.setItem("urgent_alert_expire", expireTime);

    startUrgentTimer(expireTime);
}

function startUrgentTimer(expireTime) {
    const timerLabel = document.getElementById("urgent-alert-timer");

    // wyczyÅ›Ä‡ poprzedni timer
    if (urgentInterval) clearInterval(urgentInterval);

    urgentInterval = setInterval(() => {
        const now = Date.now();
        const diff = Math.floor((expireTime - now) / 1000);

        if (diff <= 0) {
            clearInterval(urgentInterval);
            urgentInterval = null;

            const alert = document.getElementById("urgent-alert");
            const bsAlert = bootstrap.Alert.getOrCreateInstance(alert);

            bsAlert.close();   // <-- TO POWODUJE ZNIKNIECIE
            return;
        }

        timerLabel.textContent = `(pozostaÅ‚o: ${diff}s)`;
    }, 1000);
}

document.addEventListener("DOMContentLoaded", () => {
    const text = localStorage.getItem("urgent_alert_text");
    const expire = parseInt(localStorage.getItem("urgent_alert_expire"));

    if (text && expire > Date.now()) {
        document.getElementById("urgent-alert-text").textContent = text + " ";
        document.getElementById("urgent-alert").classList.remove("visually-hidden");
        startUrgentTimer(expire);
    }
});

// po zamkniÄ™ciu - wyczyÅ›Ä‡ localStorage
document.addEventListener("closed.bs.alert", (event) => {
    if (event.target.id === "urgent-alert") {
        localStorage.removeItem("urgent_alert_text");
        localStorage.removeItem("urgent_alert_expire");
        if (urgentInterval) clearInterval(urgentInterval);
    }
});

// TEST
//showUrgentAlert("UWAGA TEST", 5);
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>